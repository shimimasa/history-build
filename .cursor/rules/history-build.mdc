---
alwaysApply: true
---
Cursor Project Rules（history-build 専用・最適化版）

以下は Cursor が history-build プロジェクトにおいて必ず守るべき開発ルールである。
すべてのコード生成・修正・提案は、この仕様に従うこと。

🎮 1. ゲームデザイン（GOD）基準
■ 基本ルール

本作は「日本史 × デッキ構築型カードゲーム（ドミニオン系）」である。

プレイヤー vs CPU の 1 対 1。

勝利条件：知識ポイント（勝利点）をより多く集めた側が勝ち。

学習ゲームであるため、カード名・説明・効果は「歴史的意味を理解しやすいこと」を最優先する。

■ ターン構造（v1）

ゲームの1ターンは以下の順で進む：

資源フェーズ

手札の資源カードをすべて自動プレイ（v1はボタン1つでOK）

行動フェーズ

1ターンに 1枚だけ行動カードをプレイできる

購入フェーズ

米を支払い、サプライから 1枚購入できる

クリーンアップフェーズ

手札とプレイ領域を捨札へ

1枚引く（v1簡易仕様）

■ 終了条件

各プレイヤーが規定ターン数を終えたらゲーム終了。

勝者は「知識ポイント最大のプレイヤー」。

🧱 2. 技術仕様（TECH）基準
■ 実装スタック

React + TypeScript + Vite

Tailwind CSS

状態管理：v1 は useReducer または手動管理でOK
（Zustand の導入は v1.1 以降）

■ ディレクトリ構成（遵守）
src/
  screens/       → GameScreen（v1のメインUI）
  components/    → HandCard, SupplyCardPile など
  logic/         → turnFlow.ts / cpuLogic.ts / cardEffects.ts / initGameState.ts
  data/          → cards.json（v1は簡易版）
  types/         → 型定義（必要時）

■ 状態モデル（簡易版）

GameState

PlayerState

Card / CardInstance

SupplyCard

v1 では 効果処理は cardEffects.ts の関数群で実装し、
cards.json の effects[] 方式は v1.1 以降に導入する。

🤖 3. CPU（AI）戦略ルール

cpuLogic.ts の方針：

Early：資源カード優先

Mid：行動カード（人物）優先

Late：知識カード優先

v1ではこの「三段階のシンプル戦略」を維持する。
高度戦略（手札評価・期待値計算）は v1.1 以降で追加する。

🧩 4. 実装ルール（最重要）
■ Rule 1. UI とロジックを分離する

GameScreen.tsx は UI・操作トリガーのみ担当。

ゲームルールの更新は turnFlow.ts / cardEffects.ts / cpuLogic.ts に寄せる。

GameScreen にゲームロジックを書かない。

■ Rule 2. GOD と TECH を改変せず、準拠して実装する

仕様に矛盾する実装は行わない。

不明点があれば、GOD または TECH の精神に沿って補完する。

■ Rule 3. v1 と v1.1 以降の仕様を混同しない
v1（現在フェーズ）

ミニデッキ（戦国12枚）

シンプルな turnFlow

シンプルな CPU 戦略

GameScreen のみで結果表示（ResultScreen は不要）

cards.json は簡易版（effects なしでも可）

v1.1 以降（未来）

TitleScreen / ResultScreen の独立

データ駆動型の card.effects[]

AI の高度化

UI のカード演出強化

Cursor は v1に対する修正では、未来仕様を勝手に混ぜない。

■ Rule 4. コード修正時は “diffパッチ” で提案する

ファイル全書き換えではなく
「必要な部分だけ」差分を示すこと。

■ Rule 5. バグ修正を最優先する

フェーズ処理の矛盾

State の破綻

CPU の無限ループ

型安全性の欠如

これらは仕様より優先して修正案を出す。

■ Rule 6. 子ども向け UI を優先

日本史学習用であるため：

UI はシンプル

情報は整理して表示

カードは読みやすい文言

色分けでカテゴリーを区別

クリックで迷わない導線

とする。

🛠 5. Cursor に求める行動指針

Cursor は以下を徹底する：

■ 実装変更時：

仕様に沿っているか確認

影響範囲を明示

安全なリファクタリングを行う

■ 追加実装時：

現行 v1 仕様を維持

UI 改善と可読性向上を優先

将来拡張のための軽めの抽象化は OK

■ NG 行動：

無断で大規模リファクタを行う

仕様書にない新要素を勝手に追加

UI を複雑化しすぎる

turnFlow と GameScreen の責務を混ぜる

🎯 6. 目的

Cursor の最終目的は：

戦国デッキ v1 を “安定動作・わかりやすい UI・拡張しやすい構造” に仕上げること。

そのために必要なコードの編集・最適化・修正を主体的に行う。

🔚 この Project Rules を守らせることで得られる効果

コードがブレず、方向性が一貫する

GameScreen・turnFlow・cpuLogic の責務分離が保たれる

無駄な修正や構造破壊を防げる

あなたの意図（教育 × ゲーム）が常に反映される

長期運用にも耐えるプロジェクトになる